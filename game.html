<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Map Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-900 text-white overflow-hidden">
    <div id="app" class="relative w-screen h-screen">
      <canvas id="canvas" class="absolute inset-0 w-full h-full"></canvas>
      <div id="controls" class="absolute top-4 left-4 flex items-center gap-2 bg-gray-800 bg-opacity-90 px-4 py-2 rounded-lg shadow-lg">
        <button id="library-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-3 py-1.5 rounded transition-colors">Library</button>
        <button id="back-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-3 py-1.5 rounded transition-colors">Edit</button>
        <div class="w-px h-6 bg-gray-600"></div>
        <button id="load-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-3 py-1.5 rounded transition-colors">Load Map</button>
        <input type="file" id="load-input" accept=".map" class="hidden" />
        <div class="w-px h-6 bg-gray-600"></div>
        <button id="add-unit-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-3 py-1.5 rounded transition-colors">Add Unit</button>
        <button id="diplomacy-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-3 py-1.5 rounded transition-colors">Diplomacy</button>
        <div class="w-px h-6 bg-gray-600"></div>
        <input type="text" id="ai-command" placeholder="Give order (e.g., 'take Paris')..." class="bg-gray-700 text-white px-3 py-1.5 rounded border border-gray-600 focus:border-blue-500 focus:outline-none w-64" />
        <button id="execute-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 py-1.5 rounded transition-colors">Execute</button>
        <button id="api-key-btn" title="Set Gemini API Key" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-3 py-1.5 rounded transition-colors">API Key</button>
      </div>

      <!-- Unit Dialog -->
      <div id="unit-dialog" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
          <h3 id="unit-dialog-title" class="text-xl font-bold mb-4">Add Unit</h3>
          <div class="mb-4">
            <label for="unit-country" class="block text-sm font-medium text-gray-300 mb-1">Country</label>
            <select id="unit-country" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none"></select>
          </div>
          <div class="mb-4">
            <label for="unit-type" class="block text-sm font-medium text-gray-300 mb-1">Type</label>
            <select id="unit-type" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none">
              <option value="infantry">Infantry (Triangle)</option>
              <option value="armor">Armor (Rectangle)</option>
              <option value="artillery">Artillery (Diamond)</option>
            </select>
          </div>
          <div class="mb-6">
            <label for="unit-strength" class="block text-sm font-medium text-gray-300 mb-1">Strength (1-100)</label>
            <input type="number" id="unit-strength" min="1" max="100" value="50" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none" />
          </div>
          <div class="flex justify-between gap-3">
            <button id="unit-delete" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded transition-colors hidden">Delete</button>
            <div class="flex gap-3 ml-auto">
              <button id="unit-cancel" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-4 py-2 rounded transition-colors">Cancel</button>
              <button id="unit-save" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded transition-colors">Place Unit</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Diplomacy Dialog -->
      <div id="diplomacy-dialog" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full mx-4 shadow-xl max-h-[80vh] overflow-auto">
          <h3 class="text-xl font-bold mb-2">Diplomacy</h3>
          <p class="text-sm text-gray-400 mb-4">Click status to toggle war/peace</p>
          <div id="diplomacy-list" class="mb-6"></div>
          <div class="flex justify-end">
            <button id="diplomacy-close" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-4 py-2 rounded transition-colors">Close</button>
          </div>
        </div>
      </div>

      <!-- API Key Dialog -->
      <div id="api-key-dialog" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
          <h3 class="text-xl font-bold mb-2">Gemini API Key</h3>
          <p class="text-sm text-gray-400 mb-4">Enter your Gemini API key for AI commands</p>
          <div class="mb-6">
            <label for="api-key-input" class="block text-sm font-medium text-gray-300 mb-1">API Key</label>
            <input type="password" id="api-key-input" placeholder="Enter API key..." class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:border-blue-500 focus:outline-none" />
          </div>
          <div class="flex justify-between gap-3">
            <button id="api-key-clear" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded transition-colors">Clear</button>
            <div class="flex gap-3">
              <button id="api-key-cancel" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold px-4 py-2 rounded transition-colors">Cancel</button>
              <button id="api-key-save" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded transition-colors">Save</button>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Status Indicator -->
      <div id="ai-status" class="hidden fixed top-20 left-4 bg-gray-800 bg-opacity-90 px-4 py-3 rounded-lg shadow-lg flex items-center gap-3">
        <div class="w-5 h-5 border-3 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        <span id="ai-status-text" class="text-white font-medium">AI Planning...</span>
      </div>

      <!-- Selected Unit Info -->
      <div id="unit-info" class="hidden fixed bottom-4 left-4 bg-gray-800 bg-opacity-90 px-4 py-3 rounded-lg shadow-lg">
        <div id="unit-info-content" class="text-white text-sm"></div>
      </div>
    </div>
    <script type="module" src="/src/game.ts"></script>
  </body>
</html>
